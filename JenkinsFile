pipeline {
  agent any

  triggers {
    cron('H 5 * * *')  // Runs daily at 5 AM
  }

  stages {
    stage('Checkout') {
      steps {
        git 'https://github.com/Namratha899/email-bounce-monitor.git'
      }
    }

    stage('Run in Docker') {
      steps {
        script {
          docker.image('python:3.12-slim').inside {
            // Upgrade pip and install dependencies
            sh 'pip install --upgrade pip'
            sh 'pip install -r requirements.txt'

            // Run your Python script
            sh 'python main.py'
          }
        }
      }
    }
  }

  post {
    failure {
      mail to: 'your@email.com',
           subject: 'Bounce Monitor Job Failed',
           body: 'The Bounce Monitor Jenkins job has failed. Please check logs.'
    }
  }
}
